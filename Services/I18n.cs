using System;
using System.Collections.Generic;

internal static class I18n
{
    private static readonly object _lock = new();
    private static string _lang = "en";

    public static event EventHandler? LanguageChanged;

    private static readonly Dictionary<string, Dictionary<string, string>> _dict =
        new(StringComparer.OrdinalIgnoreCase)
        {
            ["en"] = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
            {
                ["TrayTitle"] = "ClipboardSync",
                ["MenuEnabled"] = "Enabled",
                ["MenuDisabled"] = "Disabled",
                ["MenuDeleteInbox"] = "Delete all INBOX notes",
                ["MenuSettings"] = "Settings...",
                ["MenuHelp"] = "Help...",
                ["MenuAbout"] = "About...",
                ["MenuExit"] = "Exit",
                ["ConfirmTitle"] = "Confirm",
                ["ConfirmDeleteInboxBody"] = "This will delete ALL notes in INBOX.\nDo you want to continue?",
                ["CleanupTitle"] = "Cleanup_API",
                ["CleanupRunning"] = "Deleting INBOX notes...",
                ["CleanupDoneTitle"] = "Delete INBOX: Done",
                ["CleanupFailTitle"] = "Delete INBOX: Failed",
                ["SendOkTitle"] = "Send OK",
                ["SendFailTitle"] = "Send Failed",
                ["BalloonEnabled"] = "Sending enabled",
                ["BalloonDisabled"] = "Sending disabled",
                ["AutoCleanupTitle"] = "Cleanup_API (Auto)",
                ["AutoCleanupOk"] = "Delete INBOX: Success",
                ["AutoCleanupFail"] = "Delete INBOX: Failed",
                ["CleanupModeInfoFormat"] = "(Auto-delete mode: {0})",
                ["CleanupModeOff"] = "OFF",
                ["CleanupModeDailyFormat"] = "Daily {0:00}:{1:00}",
                ["CleanupModeEveryFormat"] = "Every {0} min",
                ["CleanupModeDailyAndEveryFormat"] = "Daily {0:00}:{1:00} + Every {2} min (both ON)",
                ["CleanupLastNotYet"] = "(Last auto-delete: not yet)",
                ["CleanupLastFormat"] = "(Last auto-delete: {0} / {1})",
                ["WordSuccess"] = "Success",
                ["WordFail"] = "Fail",
                ["AboutTitle"] = "About",
                ["AboutBodyFormat"] = "{0}\nVersion: {1}\n\nHelp:\n{2}",
                ["ReceiveTitle"] = "Receive",
                ["ReceiveOkBalloon"] = "Latest note copied to clipboard",
                ["ReceiveEmpty"] = "Latest note is empty",
                ["ReceiveFailTitle"] = "Receive Failed",
                ["SettingsTitle"] = "Settings",
                ["LangLabel"] = "Language",
                ["LangEnglish"] = "English",
                ["LangJapanese"] = "日本語",
                ["LangTurkish"] = "Turkce",
                ["Save"] = "Save",
                ["Cancel"] = "Cancel",
                ["ShowToken"] = "Show token",
                ["ShowCleanupToken"] = "Show Cleanup token",
                ["TestConnection"] = "Test",
                ["EnabledCheckbox"] = "Enable sending",
                ["ShowSuccessCheckbox"] = "Show message on success",
                ["HotkeyLabel"] = "Hotkey (click and press)",
                ["PostUrlLabel"] = "POST API URL (api.php)",
                ["TokenLabel"] = "Token",
                ["CleanupSection"] = "Cleanup_API (Delete INBOX)",
                ["CleanupUrlLabel"] = "Cleanup_API URL",
                ["CleanupTokenLabel"] = "Cleanup_API token",
                ["DailyCheckbox"] = "Run INBOX delete daily (once per day)",
                ["EveryCheckbox"] = "Run INBOX delete every X minutes",
                ["TimeLabel"] = "Time",
                ["Hour"] = "hour",
                ["Minute"] = "min",
                ["EveryMinutesLabel"] = "Interval (minutes)",
                ["SavedMsg"] = "Saved",
                ["SavedTitle"] = "OK",
                ["InputErrorTitle"] = "Input error",
                ["UrlInvalid"] = "URL is invalid.\nExample: https://sample.com/notemod/ta/api/api.php",
                ["TokenEmpty"] = "Token is empty",
                ["NeedModifier"] = "Use Ctrl or Alt (or Shift) with another key",
                ["BasicAuthSection"] = "Basic Auth (optional)",
                ["BasicUserLabel"] = "Username",
                ["BasicPassLabel"] = "Password",
                ["ShowBasicPass"] = "Show password",
                ["BasicIncomplete"] = "If you set a username, please also set a password",
                ["ReceiveUrlLabel"] = "Read API URL",
                ["ReceiveHotkeyLabel"] = "Receive hotkey (click and press)",
                ["TabSendDelete"] = "Send/Delete",
                ["TabReceive"] = "Receive",
                ["ReceiveAutoPaste"] = "Auto paste after receive",
                ["ClipboardStableWaitLabel"] = "Clipboard stabilize wait (ms)",
                ["BakCountLoading"] = "Backup file: (loading...)",
                ["BakCountNone"] = "Backup file: -",
                ["BakCountFormat"] = "Backup file(s): {0}",
                ["BakCountFail"] = "Backup file: ?",
                ["PurgeBakButton"] = "Delete ALL backup files",
                ["ConfirmPurgeBakBody"] = "This will delete ALL backup files.\nDo you want to continue?",
                ["PurgeBakDoneTitle"] = "Backup file delete: Done",
                ["PurgeBakFailTitle"] = "Backup file delete: Failed",
            },
            ["ja"] = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
            {
                ["TrayTitle"] = "ClipboardSync",
                ["MenuEnabled"] = "有効",
                ["MenuDisabled"] = "無効",
                ["MenuDeleteInbox"] = "INBOX全削除",
                ["MenuSettings"] = "設定",
                ["MenuHelp"] = "ヘルプ",
                ["MenuAbout"] = "バージョン情報",
                ["MenuExit"] = "終了",
                ["ConfirmTitle"] = "最終確認",
                ["ConfirmDeleteInboxBody"] = "INBOX内のノートを全て削除します\n本当に実行しますか？",
                ["CleanupTitle"] = "Cleanup_API",
                ["CleanupRunning"] = "INBOX全削除を実行中...",
                ["CleanupDoneTitle"] = "INBOX全削除：完了",
                ["CleanupFailTitle"] = "INBOX全削除：失敗",
                ["SendOkTitle"] = "送信OK",
                ["SendFailTitle"] = "送信失敗",
                ["BalloonEnabled"] = "送信を有効化しました",
                ["BalloonDisabled"] = "送信を無効化しました",
                ["AutoCleanupTitle"] = "Cleanup_API（自動）",
                ["AutoCleanupOk"] = "INBOX全削除：成功",
                ["AutoCleanupFail"] = "INBOX全削除：失敗",
                ["CleanupModeInfoFormat"] = "(自動削除モード: {0})",
                ["CleanupModeOff"] = "OFF",
                ["CleanupModeDailyFormat"] = "定時 {0:00}:{1:00}",
                ["CleanupModeEveryFormat"] = "{0}分毎",
                ["CleanupModeDailyAndEveryFormat"] = "定時 {0:00}:{1:00} + {2}分毎（※両方ON）",
                ["CleanupLastNotYet"] = "(最終自動削除: 未実行)",
                ["CleanupLastFormat"] = "(最終自動削除: {0} / {1})",
                ["WordSuccess"] = "成功",
                ["WordFail"] = "失敗",
                ["AboutTitle"] = "バージョン情報",
                ["AboutBodyFormat"] = "{0}\nVersion: {1}\n\nヘルプ: {2}",
                ["ReceiveTitle"] = "受信",
                ["ReceiveOkBalloon"] = "最新ノートをクリップボードへコピーしました",
                ["ReceiveEmpty"] = "最新ノートが空です",
                ["ReceiveFailTitle"] = "受信失敗",
                ["SettingsTitle"] = "設定",
                ["LangLabel"] = "言語",
                ["LangEnglish"] = "English",
                ["LangJapanese"] = "日本語",
                ["LangTurkish"] = "Turkce",
                ["Save"] = "保存",
                ["Cancel"] = "キャンセル",
                ["ShowToken"] = "トークンを表示する",
                ["ShowCleanupToken"] = "Cleanup トークンを表示する",
                ["TestConnection"] = "接続テスト",
                ["EnabledCheckbox"] = "送信を有効にする",
                ["ShowSuccessCheckbox"] = "成功時もメッセージを表示する",
                ["HotkeyLabel"] = "ホットキー（クリックして押す）",
                ["PostUrlLabel"] = "POST API (api.php) の URL または、パス",
                ["TokenLabel"] = "トークン (EXPECTED_TOKEN)",
                ["CleanupSection"] = "Cleanup_API（INBOX全削除）",
                ["CleanupUrlLabel"] = "Cleanup API (cleanup_api.php) の URL または、パス",
                ["CleanupTokenLabel"] = "トークン (ADMIN_TOKEN)",
                ["DailyCheckbox"] = "定時でINBOX全削除を実行する（1日1回）",
                ["EveryCheckbox"] = "x分毎にINBOX全削除を実行する",
                ["TimeLabel"] = "時刻",
                ["Hour"] = "時",
                ["Minute"] = "分",
                ["EveryMinutesLabel"] = "間隔（分）",
                ["SavedMsg"] = "保存しました",
                ["SavedTitle"] = "OK",
                ["InputErrorTitle"] = "入力エラー",
                ["UrlInvalid"] = "URLが正しくないです\n例: https://sample.com/notemod/ta/api/api.php",
                ["TokenEmpty"] = "トークンが空です",
                ["NeedModifier"] = "Ctrl または Alt（または Shift）と組み合わせてください",
                ["BasicAuthSection"] = "BASIC認証（任意）",
                ["BasicUserLabel"] = "ユーザー名",
                ["BasicPassLabel"] = "パスワード",
                ["ShowBasicPass"] = "パスワードを表示する",
                ["BasicIncomplete"] = "ユーザー名を設定した場合は、パスワードも設定してください",
                ["ReceiveUrlLabel"] = "Read API (read_api.php) の URL または、パス",
                ["ReceiveHotkeyLabel"] = "受信ホットキー（クリックして押す）",
                ["TabSendDelete"] = "送信/削除設定",
                ["TabReceive"] = "受信設定",
                ["ReceiveAutoPaste"] = "ペーストまで含める",
                ["ClipboardStableWaitLabel"] = "クリップボード安定待ち（ms）",
                ["BakCountLoading"] = "バックアップファイル: 取得中...",
                ["BakCountNone"] = "バックアップファイル: -",
                ["BakCountFormat"] = "バックアップファイル: {0}",
                ["BakCountFail"] = "バックアップファイル: ?",
                ["PurgeBakButton"] = "バックアップファイルを全削除",
                ["ConfirmPurgeBakBody"] = "バックアップファイルを全て削除します\n本当に実行しますか？",
                ["PurgeBakDoneTitle"] = "バックアップファイル削除：完了",
                ["PurgeBakFailTitle"] = "バックアップファイル削除：失敗",
            },
            ["tr"] = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
            {
                ["TrayTitle"] = "ClipboardSync",
                ["MenuEnabled"] = "Etkin",
                ["MenuDisabled"] = "Devre d???",
                ["MenuDeleteInbox"] = "INBOX'taki tum notlar? sil",
                ["MenuSettings"] = "Ayarlar...",
                ["MenuHelp"] = "Yard?m...",
                ["MenuAbout"] = "Hakk?nda...",
                ["MenuExit"] = "C?k??",
                ["ConfirmTitle"] = "Onay",
                ["ConfirmDeleteInboxBody"] = "Bu i?lem INBOX icindeki TUM notlar? silecektir.\nDevam etmek istiyor musunuz?",
                ["CleanupTitle"] = "Cleanup_API",
                ["CleanupRunning"] = "INBOX notlar? siliniyor...",
                ["CleanupDoneTitle"] = "INBOX silme: Tamamland?",
                ["CleanupFailTitle"] = "INBOX silme: Ba?ar?s?z",
                ["SendOkTitle"] = "Gonderme ba?ar?l?",
                ["SendFailTitle"] = "Gonderme ba?ar?s?z",
                ["BalloonEnabled"] = "Gonderme etkin",
                ["BalloonDisabled"] = "Gonderme devre d???",
                ["AutoCleanupTitle"] = "Cleanup_API (Otomatik)",
                ["AutoCleanupOk"] = "INBOX silme: Ba?ar?l?",
                ["AutoCleanupFail"] = "INBOX silme: Ba?ar?s?z",
                ["CleanupModeInfoFormat"] = "(Otomatik silme modu: {0})",
                ["CleanupModeOff"] = "KAPALI",
                ["CleanupModeDailyFormat"] = "Gunluk {0:00}:{1:00}",
                ["CleanupModeEveryFormat"] = "{0} dakikada bir",
                ["CleanupModeDailyAndEveryFormat"] = "Gunluk {0:00}:{1:00} + {2} dakikada bir (ikisi de ac?k)",
                ["CleanupLastNotYet"] = "(Son otomatik silme: henuz yok)",
                ["CleanupLastFormat"] = "(Son otomatik silme: {0} / {1})",
                ["WordSuccess"] = "Ba?ar?l?",
                ["WordFail"] = "Ba?ar?s?z",
                ["AboutTitle"] = "Hakk?nda",
                ["AboutBodyFormat"] = "{0}\nSurum: {1}\n\nYard?m: {2}",
                ["ReceiveTitle"] = "Al",
                ["ReceiveOkBalloon"] = "En son not panoya kopyaland?",
                ["ReceiveEmpty"] = "En son not bo?",
                ["ReceiveFailTitle"] = "Alma ba?ar?s?z",
                ["SettingsTitle"] = "Ayarlar",
                ["LangLabel"] = "Dil",
                ["LangEnglish"] = "English",
                ["LangJapanese"] = "日本語",
                ["LangTurkish"] = "Turkce",
                ["Save"] = "Kaydet",
                ["Cancel"] = "?ptal",
                ["ShowToken"] = "Token'? goster",
                ["ShowCleanupToken"] = "Cleanup token'?n? goster",
                ["TestConnection"] = "Test",
                ["EnabledCheckbox"] = "Gondermeyi etkinle?tir",
                ["ShowSuccessCheckbox"] = "Ba?ar?da da mesaj goster",
                ["HotkeyLabel"] = "K?sayol (t?kla ve bas)",
                ["PostUrlLabel"] = "POST API URL (api.php)",
                ["TokenLabel"] = "Token",
                ["CleanupSection"] = "Cleanup_API (INBOX sil)",
                ["CleanupUrlLabel"] = "Cleanup_API URL",
                ["CleanupTokenLabel"] = "Cleanup_API token",
                ["DailyCheckbox"] = "INBOX silmeyi gunluk cal??t?r (gunde 1 kez)",
                ["EveryCheckbox"] = "INBOX silmeyi X dakikada bir cal??t?r",
                ["TimeLabel"] = "Saat",
                ["Hour"] = "saat",
                ["Minute"] = "dk",
                ["EveryMinutesLabel"] = "Aral?k (dakika)",
                ["SavedMsg"] = "Kaydedildi",
                ["SavedTitle"] = "OK",
                ["InputErrorTitle"] = "Girdi hatas?",
                ["UrlInvalid"] = "URL gecersiz.\nOrnek: https://sample.com/notemod/ta/api/api.php",
                ["TokenEmpty"] = "Token bo?",
                ["NeedModifier"] = "Ctrl veya Alt (ya da Shift) + ba?ka bir tu? kullan?n",
                ["BasicAuthSection"] = "Basic Auth (iste?e ba?l?)",
                ["BasicUserLabel"] = "Kullan?c? ad?",
                ["BasicPassLabel"] = "Parola",
                ["ShowBasicPass"] = "Parolay? goster",
                ["BasicIncomplete"] = "Kullan?c? ad? girerseniz parolay? da girin",
                ["ReceiveUrlLabel"] = "Read API URL",
                ["ReceiveHotkeyLabel"] = "Alma k?sayolu (t?kla ve bas)",
                ["TabSendDelete"] = "Gonder/Sil",
                ["TabReceive"] = "Al",
                ["ReceiveAutoPaste"] = "Al?nca otomatik yap??t?r",
                ["ClipboardStableWaitLabel"] = "Pano stabilize bekleme (ms)",
                ["BakCountLoading"] = "Yedek dosyas?: (yukleniyor...)",
                ["BakCountNone"] = "Yedek dosyas?: -",
                ["BakCountFormat"] = "Yedek dosyas?: {0}",
                ["BakCountFail"] = "Yedek dosyas?: ?",
                ["PurgeBakButton"] = "Tum yedek dosyalar?n? sil",
                ["ConfirmPurgeBakBody"] = "TUM yedek dosyalar? silinecek.\nDevam etmek istiyor musunuz?",
                ["PurgeBakDoneTitle"] = "Yedek dosyas? silme: Tamam",
                ["PurgeBakFailTitle"] = "Yedek dosyas? silme: Ba?ar?s?z",
            },
        };

    public static IReadOnlyList<(string code, string displayName)> SupportedLanguages { get; } =
        new List<(string, string)> { ("en", "English"), ("ja", "日本語"), ("tr", "Turkce") };

    public static void SetLanguage(string? langCode)
    {
        bool changed = false;
        lock (_lock)
        {
            var before = _lang;
            if (string.IsNullOrWhiteSpace(langCode)) _lang = "en";
            else _lang = _dict.ContainsKey(langCode) ? langCode : "en";
            changed = !string.Equals(before, _lang, StringComparison.OrdinalIgnoreCase);
        }
        if (changed) LanguageChanged?.Invoke(null, EventArgs.Empty);
    }

    public static string CurrentLanguage { get { lock (_lock) return _lang; } }

    public static string T(string key)
    {
        lock (_lock)
        {
            if (_dict.TryGetValue(_lang, out var d) && d.TryGetValue(key, out var v)) return v;
            if (_dict.TryGetValue("en", out var en) && en.TryGetValue(key, out var ev)) return ev;
            return key;
        }
    }
}